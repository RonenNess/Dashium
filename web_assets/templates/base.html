<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{site_title}} | {{page_title}}{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    
    <!-- Bootstrap CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="/static/css/bootstrap.icons.css" rel="stylesheet" crossorigin="anonymous">

    <!-- Custom CSS (optional) -->
    <link href="/static/css/app.css" rel="stylesheet">
    
    {% block extra_head %}{% endblock %}

  </head>
  <body>

    <!-- set dark mode as early as possible to reduce flickering. later down below we do this via proper utils wrapper -->
    <script>
      if (localStorage.getItem('darkMode') === 'true') {
        const htmlEl = document.documentElement;
        htmlEl.setAttribute('data-bs-theme', 'dark');
      }
    </script>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="/"><img src="/static/img/Dashium_Icon_White.png" width="auto" height="20" style="margin-top: -0.2em; margin-right: 0.5em;" />{{site_title}}</a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="navbar-nav ms-auto">
            
            {% block navbar_menu %}
              {% for link in top_bar_links %}
              <a class="nav-link" href="{{ link.url }}">{{ link.title }}</a>
              {% endfor %}
            {% endblock %}

            {% if show_logout_button %}
              <a class="nav-link" href="/logout">Logout</a>
            {% endif %}
            {% if show_login_button %}
              <a class="nav-link" href="/login">Login</a>
            {% endif %}

            <!-- dark mode toggle -->
            <li class="nav-item">
              <button id="themeToggleBtn" onclick="HtmlUtils.toggleDarkMode()" class="btn d-flex align-items-center" title="Toggle dark/light mode">
                <span id="theme-icon" class="bi bi-moon-fill"></span>
              </button>
            </li>

          </div>
        </div>
        
      </div>
    </nav>

    <div class="container-fluid mt-4">
      {% block content %}
      {% endblock %}
    </div>

    <footer class="mt-5 py-3">
      <div class="container-fluid text-center">
        <small class="text-muted">{{server_info}}</small>
        {% block footer_extra %}{% endblock %}
      </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="/static/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    
    <!-- Get echarts -->
    <script src="/static/js/echarts.min.js"></script>

    <!-- Get utils -->
    <script src="/static/js/html_utils.js"></script>
    <script src="/static/js/api_utils.js"></script>

    <!-- Set initial dark mode preference -->
    <script>
      if (localStorage.getItem('darkMode') === 'true') {
          HtmlUtils.enableDarkMode(true);
      }
    </script>
    
    {% block extra_scripts %}
    <script>
        async function testAPI() {
            try {
                const response = await fetch('/api/test?param1=value1&param2=value2');
                const data = await response.json();
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        }
    </script>
    {% endblock %}

  </body>
</html>